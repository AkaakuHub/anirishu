<!DOCTYPE html>
<html lang="ja">

<head>
    <title>あにりしゅ！- News</title>
    <meta charset="utf-8">
    <meta name="description" content="アニメの履修登録を行うことができるサイトです。">
    <meta name="keywords" content="アニメ,あにめ,anime,ANIME,履修登録,course registration">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="NEWS | あにりしゅ！">
    <meta property="og:locate" content="ja_JP">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="NEWS | あにりしゅ！">
    <meta name="twitter:description" content="アニメの履修登録を行うことができるサイトです。">
    <link rel="stylesheet" type="text/css" href="../../css/stylesheet.css">
    <script type="module" src="../../scripts/javascript_news.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1+Code:wght@300&display=swap" rel="stylesheet">
    <!--syntax highlight-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/ir-black.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

    <style>
    </style>
</head>

<body>
    <div id="tomain">
        <a href="/" target="_parent">戻る</a>
    </div>
    <header class="header_news">
        <nav>
            <div>
                <h1>あにりしゅ！</h1>
            </div>
        </nav>
        <div class="news_top">
            <h3>NEWS</h3>
        </div>
    </header>
    <div class="news_parent_container">
        <div class="news_child">
            <h3 id="JSdisabled">JavaScriptが無効になっています。<br>有効にしないと正しく動作しません。</h3>
            <div id="news_container">
                <!--memo: newslist.jsonを追記すること-->
                <div class="news_box" id ="202312071">
                    <div class="news_date">2023/12/07</div>
                    <div class="news_title">アニメオタクのためのサイトを作った</div>
                </div>
                <div class="news_box" id ="202311241">
                    <div class="news_date">2023/11/24</div>
                    <div class="news_title">共有されたクエリが表示されないバグを修正しました。</div>
                </div>
                <div class="news_box" id="202310141">
                    <div class="news_date">2023/10/14</div>
                    <div class="news_title">インポート機能を追加しました。</div>
                </div>
                <div class="news_box" id="202310131">
                    <div class="news_date">2023/10/13</div>
                    <div class="news_title">サイトを公開しました。</div>
                </div>
            </div>
        </div>
    </div>
    <!-- news本文 -->
    <div id="news_main" style="display: none;">
        <div id="202312071">
            <!--後で埋め込みノプレビューを再現する-->
            <h4>はじめに</h4>
            この記事はUEC 2 Advent Calendar 2023の7日目の記事です。<br>
            昨日は俵屋宗達さんの記事「言葉で遊ぼうよ リポグラム編」でした！<br>
            <a href="https://note.com/tawaraya_so618/n/naa1284eaf9ca" target="_blank">https://note.com/tawaraya_so618/n/naa1284eaf9ca</a><br>
            <div class="md_backq">
                リポグラムという言葉自体は知らなかったのに、すごく面白いと思いました。
                ある文字を使わないまま文章を書くという言葉あそびは、
                日本語の特徴をうまく使うのが凄いと思います。
                ちなみにこの部分も「う」と「お」の間の文字の行の母音を使わないまま書きました。
                大分難しかったと感じました。
            </div>
            よければ他の記事もご覧ください！<br> 
            <a href="https://adventar.org/calendars/8704" target="_blank">https://adventar.org/calendars/8704</a>
            <h4>概要</h4>
            今期にどのアニメを見ているか、何曜日の何時から始まるかを簡単に確認したくなったのがこのサイトを作ろうと思ったきっかけです。
            まるで履修登録のような感覚で、アニメを登録することができます。
            また、簡単に他人と共有することもできます。<br>
            何気にちゃんとした<div class="md_backq">サイト||ブログ</div>を作るのはこれが初めてな気がします。
            今回この記事では、このサイトを作るにあたってのこだわりポイントや、技術面でがんばったことをまとめていきたいと思います。最後までよろしくお願いします。<br>

            <h4>こだわりポイント</h4>
            さっきからこのサイトと何度も言っていますが、なんと、この記事を書いているサイトが今回紹介するサイトそのものなんです。
            左上のバツ印を押して右上の戻るボタンを押してみてください。メインページに飛ぶことができます。
            それはそうとして、技術的な話としては記事ごとに固有のクエリを持たせて、それをURLに入れることで、外部からページを開いても特定の記事を表示することができます。
            また、そのOGP処理を結構頑張りました。
            <br><br>

            このように、こだわりポイントを全部書いてたら多すぎて流石に日が暮れてしまいそうなので、仕方なく抜粋していきます(暇な人は良かったらとても汚いコードでも読んでいってください)。<br>

            まず、アニメのデータベースを用意する必要があったので、0から作りました。<br>
            具体的にはただ単に以下のような<div class="md_backq">JSONファイル</div>を書いているだけなのですが、
            公式サイトのURLやキーワードは敢えて手動で入力しています。<br>

<code class="json">    "アニメタイトル(分類)": {
        "aid": "230099xx",
        "time": "24:00",
        "koma": "mo1",
        "url": "https://example.com/",
        "kw": "略称など"
    },
</code>
            こうすることで、「今期はどんなアニメがあるのかなー」が自動的にできて一石二鳥です。
            <div class="yt_iframe">
                <iframe alt="TVアニメ「ティアムーン帝国物語～断頭台から始まる、姫の転生逆転ストーリー～」ノンクレジットOP映像｜上坂すみれ「ハッピーエンドプリンセス」"
                src="https://www.youtube-nocookie.com/embed/g_HHqi_dpwo"
                title="YouTube video player" 
                frameborder="0" allowfullscreen>
                </iframe>
            </div>
            その作業のおかげで今まで自分が追っていなかった面白いアニメにたくさん出会うことが出来ました。
            ティアムーン帝国物語はそのうちの一つです。こういう勘違いで上手く事が運ぶ系のアニメは個人的には好きです。
            よければ見てみてください！<br>
            <br><br>

            次に紹介するのは、今回記事を書くにあたって最も苦労したともいえる、プラットフォームの準備です。<br>
            自前のプラットフォームで記事を書くのは今回がはじめてなので、みんなどんな感じなのかなーと調べて見ました。
            マークダウンから変換する方法や、mdxを使う方法がありそうですね。<br>
            <div class="md_big3">しかし！</div><br>
            今回はなぜか(?)逆張りでHTMLのままいこうと決めました(mdxはまた別の機会にやろうと思います)。<br>
            まあコードブロックとかいろいろ自分で作ってみたかったというのもありますが…<br>

            ちなみに、コピー機能もつけてます。試しにコピーしてみてね<br>
<code class="python"># (´･_･`)が なかまになりたそうに こちらをみている
# ゴヴィッショヌ in python
import random

def govisshonu():
    logarray = []
    dict = ["(", "´", "･", "_", "･", "`", ")"]
    while True:
        w = dict[random.randint(0, 6)]
        logarray.append(w)
        print(w, end = "")
        if w == "&#041;":
            if "".join(logarray[-7:]) == "(´･_･`)":
                print(f"\n{len(logarray)}文字目でｺﾞｳﾞｨｯｼｮﾇが完成しました！")
                return

govisshonu() if __name__ == "__main__" else None
</code>
            シンタックスハイライトには<div class="md_backq">Highlight.js</div>というのがすごく有能でした。<br>
            <a href="https://highlightjs.org/" target="_blank">https://highlightjs.org/</a><br>

            いつもお世話になるDiscordやStack Overflowでも使われているそうです。
            そして、毎回コードブロックのために長いコードを繰り返すのはめんどくさいので、JavaScript側で共通部分は挿入するようにしました。<br><br>


            ...ちなみにこの少し上に表示されるはずである埋め込みのプレビューも(クロスオリジン問題を解決する手法は流石にググりましたが)がんばって実装しました。<br><br>

            その他にも、iOSの自動ズームを無効化したりレイアウトを超調整(⁉️)したりなどたくさんのこだわりがあります。<br>
            (ちなみに⁉️は環境によって絵文字で表示されなかったり周りの文字が太くなってる気がしますがすべてはゴママヨのせいです。)

            <h4>OGP</h4>
            前述したように、このサイトの目的は要するにアニメ一覧を表示するだけなので、Github Pagesで公開するつもりですべてを開発していました。
            その方針でHTMLやJavaScriptも書いていたのですが、ある日、<br>
            <div class="md_big3">OGP</div><br>
            なるものの存在を意識し始めました。(デカ文字長押ししてみてね)<br>
            確かに、URLを貼ったときに画像が表示されないのはちょっと寂しいですよね。<br>
            しかも、せっかくTwitter(𝕏)で共有してほしいのにユーザーごとの結果が反映されてないと面白くないので、動的にOGPを生成することにしました。
            そして、それを可能にしてくれるのが例の…<br>
            そうです、あの<div class="md_backq">Next.js</div>です。<br>
            <a href="https://nextjs.org/" target="_blank">https://nextjs.org/</a><br>
            これを使うことで、サーバーサイドで動的にOGPを生成することができると分かりました。<br>
            これをSSRといいます。
            多分最高レアなので、みんなも使ってみてね。<br><br>
            今回サイトをホストするサービスとしては、Vercelを選びました。
            理由は単純で、無料で簡単に利用できるからです。
            ちなみにNext.jsはVercelが開発したそうです。<br><br>
            何もかもが初めてなので、とりあえずサンプルコード、もとい先人たちの知恵をありがたく参考にさせてもらって何とか動的OGPの
            実装をすることができました！<br>
<code class="javascript">import &#123; useState &#125; from "react";
import &#123; useRouter &#125; from "next/router";
import Head from "next/head";
import Script from 'next/script';

const Home = &#040;&#041; =&gt; &#123;
    const router = useRouter&#040;&#041;;
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL ?? "";
    const [text, setText] = useState&lt;string&gt;&#040;&#041;;
    const inputHandler = &#040;e: &#123; target: &#123; value: string &#125; &#125;&#041; =&gt; &#123;
        setText&#040;e.target.value&#041;;
    &#125;;

    const ogImage = router.query.aid ? `$&#123;baseUrl&#125;/api/ogp?aid=$&#123;router.query.aid&#125;` : "/default.png";
    return &#040;
        &lt;div&gt;
            &lt;Head&gt;
                &lt;title&gt;あにりしゅ！&lt;/title&gt;
                &lt;meta charSet="utf-8" /&gt;
                &lt;meta name="description" content="アニメの履修登録を行うことができるサイトです。" /&gt;
                &lt;meta name="keywords" content="アニメ,あにめ,anime,ANIME,履修登録,course registration" /&gt;
                &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;
                &lt;meta property="og:type" content="website" /&gt;
                &lt;meta property="og:url" content=&#123; baseUrl &#125; /&gt;
                &lt;meta
                    property="og:image"
                    key="ogImage"
                    content= &#123;ogImage&#125;
                /&gt;
                (後略)
</code>
            ここでTypeScriptを使っていますが、これは手本にしたコードがTSだったからです。
            <br>
            まあ、型があって安心なので、不要な間違いを防ぐことができるという優秀な言語です。
            だから、タイプスクリプトを使う必要があったんですね。<br>
<br>
            次に外部サイトからのOGP取得に取り掛かろうとしました。が、ここで問題が発生します。<br>
            そうです、nextではHTMLではなく、JSXでページの要素を書く必要があるのです。
            当然、最初はHTMLで書いていたので、そのままでは動きません。
            初めは素直に書き換える作業をするつもりでした。しかし、tableなどの制約が強くそのまま使えないことが分かり、
            iframeの中にHTMLを埋め込むという荒業で<div class="md_backq">紛争を開始</div>しないことにしました(そのおかげで色々と煩雑になったのはまた別の話ですが)。<br><br>

            <div class="news_fig">
                <img src="../../pictures/202312071_fig1.png" alt="fig1"/>
                <div>図1. 終わってる構造の例</div>
            </div>

            しかし、この苦行を乗り越えたことで、上の図のように無事？外部サイトのOGPプレビュー機能を完成させることが出来ました！
            これ、むしろ苦行の方のアドカレなのでは？？<br>
            <br>
            こんなハチャメチャなコードは書いたことないのですが、とりあえず以下のように、
            iframe越しにメッセージを送りあう方針で実装しました。
<code class="javascript">function makeEmbed(id) {
    // idの中の記事のすべてのaタグを探して、そのhrefの中身を抽出
    let news_main_elm = $("#news_main").find("#" + id);
    // 中略
    parent.postMessage({ type: 'makeEmbed', links: links_array }, '*');
}
</code>
<code class="javascript">// メッセージ受信
window.addEventListener('message', async function (event) {
    if (event.data.type === "makeEmbed") {
        let links_array = event.data.links;
        for (let url of links_array) {
            let ogp_data = await getOGP(url);
            let iframe = document.getElementById("iframe_main");
            iframe.contentWindow.postMessage({ type: "ogp", ogp: ogp_data, url: url }, '*');
        }
    }
});
</code>
            実装してみて、意外となんとかなるものなんだと思いました。<br>
            
            そうこうしているうちに、ついになんとかブログとして完成させることができました。


            <h4>おすすめ</h4>
            ここで、最近はまっている声優さんを紹介したいと思います。<br>
            まずは、<div class="md_backq">小倉唯</div>さんです。というわけで、個人的お気に入り曲を紹介します(本当はMV貼りたかったけど埋め込み無効化されてた)。
            <div class="yt_iframe">
                <iframe alt="【公式】『私の百合はお仕事です！』OP主題歌 小倉 唯「秘密♡Melody」ノンクレジット映像"
                src="https://www.youtube-nocookie.com/embed/DXHqGrX6jMo"
                title="YouTube video player" 
                frameborder="0" allowfullscreen>
                </iframe>
            </div>

            私はこの曲がきっかけでわたゆりを見始めました。それくらい曲が好きです。<br>
            次は、Future Strikeという曲です。残念ながら埋め込めなかったのでリンクを貼っておきます。<br>
            <a href="https://youtu.be/-rrxUPDS-l0" target="_blank">https://youtu.be/-rrxUPDS-l0</a><br><br>

            超かっこいいです。かわいい×かっこいいの最強コンビネーションです。<br>

            また、<div class="md_backq">東山奈央</div>さんも好きです。こちらも個人的お気に入り曲を紹介します。<br>
            <div class="yt_iframe">
                <iframe alt="東山奈央「グー」Music Video（作詞/作編曲：かいりきベア）"
                src="https://www.youtube-nocookie.com/embed/UTpw4ZRa1dU"
                title="YouTube video player" 
                frameborder="0" allowfullscreen>
                </iframe>
            </div>

            この曲はなんと、あのかいりきベアさんが作詞作編曲をしているんです！
            このかっこよさが癖になります。

            <div class="yt_iframe">
                <iframe alt="東山奈央「歩いていこう！」ミュージックビデオ（Short Ver.）"
                src="https://www.youtube-nocookie.com/embed/nIM0u59Le1k"
                title="YouTube video player" 
                frameborder="0" allowfullscreen>
                </iframe>
            </div>

            この曲は、テレビアニメ「恋する小惑星」のOPです。雰囲気がきららっぽくてとても良いです。
            全人類きららアニメを見ましょう。


<br>
<br>
            と、こんな感じでiframeなどを自由にカスタマイズできるのがHTML(JSX)のメリットだと私は思います。<br>

            <h4>まとめ</h4>
            
            <s>いかかでしたか？</s>
            前半は技術の紹介、後半はただのオタクトークになってしまいましたが、
            今回の記事をそろそろ締めたいと思います。<br>

            明日の記事は、らぼねこさんの「UECを周回プレイする方法」です。
            周回プレイを現実でする方法があるのか、とても気になります...
            もし成功したら是非ワザップに掲載してほしいですね。<br>
            <a href="https://sp.jp.wazap.com/" target="_blank">https://sp.jp.wazap.com/</a><br>
            この記事はここまでです。拙い文章でしたが最後まで読んでいただきありがとうございました！<br>
        </div>
        <div id="202311241">
            特定の要素が読み込まれるのを待つことによって正しく実装することができました。
<code class="javascript">const jsInitCheckTimer = setInterval(jsLoaded, 1000);
function jsLoaded() {
    if (document.getElementById("hogehoge") != null) {
        clearInterval(jsInitCheckTimer);
        // 処理
    }
}
</code>
        </div>
        <div id="202310141">
            メニュー > Cookieをインポート から、Cookieをインポートすることができます。<br>
            インポートすると、自動で再読み込みされ、結果が反映されます。<br>
        </div>
        <div id="202310131">
            サイトを公開しました。<br>お問い合わせ等はすべて問い合わせフォームからお願いします。
        </div>
    </div>
    <!-- テキストずれ対策 -->
    <div id="footer">
        このサイトに登場する名称、アイコン等の権利はすべて権利者に帰属します。<br>このサイトは非公式のものであり、権利者とは一切関係ありません。
    </div>
    <div id="TopButton"><a href="#"></a></div>

    <!-- ポップアップ -->
    <div class="modal-overlay closed_modal" id="modal-overlay"></div>
    <div class="modal closed_modal" id="modal">
        <div class="modal-guts">
            <div class="modal_header">
                <button class="close-button" id="close-button"><a></a></button>
                <div class="modal_title"><b>News Title</b></div>
                <div class="progress-bar"></div>
            </div>
            <div class="modal_field_news">
                <div class="modal_date">News Date</div>
                <div class="modal_text">News Text</div>
            </div>
        </div>
    </div>
    <!-- loading -->
    <div id="loading">
        <img src="../../icon_load.gif" alt="loading" width="100" height="100" />
    </div>
</body>

</html>